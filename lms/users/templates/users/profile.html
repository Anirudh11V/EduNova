{% extends 'main.html' %}
{% load static %}
{% block content %}

{% block title %}
    {{page_title}}
{% endblock title %}

<section class="mt-3">
    <div class="row justify-content-center">

        <div class="col-md-4 text-center">
            <img src="{{user.profile.profile_pics.url}}" alt="{{user.username}}'s avatar" 
            srcset="{% static 'image/default.jpg' %}"
            class="img-fluid rounded-circle mb-3" id="profile_img_pic">

            <h3> {{user.username}} </h3>
            <div class="mb-2">
                {% if user.is_instructor %}
                    <span class="badge bg-success">Instructor</span>
                
                {% elif user.is_student %}
                    <span class="badge bg-secondary">Student</span>

                {% endif %}
            </div>
            
            <p class="text-muted"> {{user.profile.bio|default:"No bio yet."}} </p>
        </div>

        <div class="col-md-4 text-center">
            <p class="text-muted fw-bold"> {{user.profile.headline}} </p>
            {% if user.profile.location %}
                <p><small> {{user.profile.location}} </small></p>
            {% endif %}

            <div>
                {% if user.profile.website_url %}
                    <a href="{{user.profile.website_url}}" target="_blank" class="btn btn-sm btn-outline-secondary m-1">
                        website
                    </a>
                {% endif %}

                {% if user.profile.whatsapp_url %}
                    <a href="{{user.profile_whatsapp_url}}" target="_blank" class="btn btn-sm btn-outline-info m-1">
                        whatsapp
                    </a>
                {% endif %}
            </div>  
        </div>

        <div class="col-md-8">
            <ul class="nav nav-tabs" id="myTab" role="tablist">

                <li class="nav-item fw-bold " role="presentation">

                    <button type="button" class="nav-link active" id="profile-tab"
                        data-bs-toggle="tab" data-bs-target="#profile-tab-pane" role="tab">
                        My Content
                    </button>

                    <button type="button" class="nav-link" id="settings-tab"
                        data-bs-toggle="tab" data-bs-target="#settings-tab-pane" role="tab">
                        Account Settings
                    </button>

                </li>

            </ul>

            <div class="tab-content" id="myTabContent">
                {% if request.user.is_authenticated %}
                <div class="tab-pane fade show active p-3" id="profile-tab-pane" role="tab-panel">

                    <div class="row text-center mb-4">
                        {% for key, value in profile_stats.items %}
                            <div class="col">
                                <div class="card">

                                    <div class="card-body">
                                        <h4 class="card-title"> {{value|floatformat:1}} </h4>
                                        <p class="card-text text-muted"> {{key}} </p>
                                    </div>

                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    {% if user.is_instructor %}
                        <h5 class="text-center text-muted mt-2 mb-2">Course I've Created</h5>

                        <div class="list-group">
                            {% for course in user_content %}
                                <a href="{{course.get_absolute_url}}" 
                                class="list-group list-group-item list-group-item-action">
                                    {{course.title}}
                                </a>
                            
                            {% empty %}
                                <p>You haven't created any course yet.</p>

                            {% endfor %}
                        </div>

                    {% elif user.is_student %}
                        <h5 class="text-center text-muted mt-2 mb-2">My Reviews</h5>

                        <div class="list-group">
                            {% for review in user_content %}
                                <a href="{{review.course.get_absolute_url}}"
                                class="list-group-item list-group-item-action">

                                    <strong>{{review.course.title}}</strong>: "{{review.comment|truncatewords:10}}"
                                    ({{review.rating}}/5)

                                </a>

                            {% empty %}
                                <p>You haven't written any reviews yet.</p>

                            {% endfor %}
                        </div>

                    {% endif %}
                </div>

                <div class="tab-pane fade p-3" id="settings-tab-pane" role="tabpanel">
                    <h5 class="text-muted text-center mt-3 m-auto">Edit Profile</h5>

                    <form action="" method="post" enctype="multipart/form-data"> {% csrf_token %}
                        {{user_form.as_p}}
                        {{profile_form.as_p}}

                        <button type="submit" class="btn btn-primary w-50"> save changes</button>

                        <a href="{% url 'password_reset' %}" class="btn btn-secondary">
                            change password
                        </a>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>

    </div>
</section>

{% endblock content %}